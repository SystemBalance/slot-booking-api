# Slot Booking API

> Laravel 12 API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—Ä–æ–Ω—å—é —Å–ª–æ—Ç–æ–≤ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ–≤–µ—Ä—Å–µ–ª–∞, –≥–æ—Ä—è—á–∏–º –∫–µ—à–µ–º –∏ –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ–≤–µ—Ä—Å–µ–ª–∞** - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
- ‚úÖ **–ì–æ—Ä—è—á–∏–π –∫–µ—à** - Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç cache stampede
- ‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Race condition protection** - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- ‚úÖ **–•–æ–ª–¥—ã —Å TTL** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ (5 –º–∏–Ω—É—Ç)
- ‚úÖ **–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
git clone https://github.com/SystemBalance/slot-booking-api.git
cd slot-booking-api
cp .env.example .env
composer install
php artisan key:generate
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

–í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –≥–æ—Ç–æ–≤—ã! –°–∫–æ–ø–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ —Å–≤–æ–π Laravel –ø—Ä–æ–µ–∫—Ç:

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- `database/migrations/2024_01_01_000000_create_slots_table.php`
- `database/migrations/2024_01_02_000000_create_holds_table.php`

**–ú–æ–¥–µ–ª–∏:**
- `app/Models/Slot.php`
- `app/Models/Hold.php`

**–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π:**
- `app/Services/SlotService.php`

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã:**
- `app/Http/Controllers/Api/AvailabilityController.php`
- `app/Http/Controllers/Api/HoldController.php`

**–ú–∞—Ä—à—Ä—É—Ç—ã:**
- `routes/api.php` (–¥–æ–±–∞–≤–∏—Ç—å routes –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –Ω–∏–∂–µ)

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

```bash
php artisan migrate
```

### 4. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
php artisan tinker
>>> Slot::create(['capacity' => 10, 'remaining' => 10])
>>> Slot::create(['capacity' => 5, 'remaining' => 5])
>>> exit
```

### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
php artisan serve
```

## üì° API Endpoints

### –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã

```bash
curl http://localhost:8000/api/slots/availability
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {"slot_id": 1, "capacity": 10, "remaining": 9},
  {"slot_id": 2, "capacity": 5, "remaining": 5}
]
```

### –°–æ–∑–¥–∞—Ç—å —Ö–æ–ª–¥

```bash
curl -X POST http://localhost:8000/api/slots/1/hold \\
  -H "Idempotency-Key: 550e8400-e29b-41d4-a716-446655440000"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "slot_id": 1,
  "status": "held",
  "idempotency_key": "550e8400-e29b-41d4-a716-446655440000",
  "expires_at": "2024-11-14T18:05:00Z"
}
```

### –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ö–æ–ª–¥

```bash
curl -X POST http://localhost:8000/api/holds/1/confirm
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "slot_id": 1,
  "status": "confirmed",
  "idempotency_key": "550e8400-e29b-41d4-a716-446655440000"
}
```

### –û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–ª–¥

```bash
curl -X DELETE http://localhost:8000/api/holds/1
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### `SlotService`
–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –≤—Å—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç cache stampede
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race conditions
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–ª–¥–æ–≤
1. **–°–æ–∑–¥–∞–Ω–∏–µ** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ + —Å–æ–∑–¥–∞–Ω–∏–µ —Å TTL
2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ remaining
3. **–û—Ç–º–µ–Ω–∞** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç + –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞

### –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º
- **Cache stampede** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Cache::remember —Å TTL
- **Race condition** - `lockForUpdate()` –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- **–û–≤–µ—Ä—Å–µ–ª** - –ü—Ä–æ–≤–µ—Ä–∫–∞ remaining –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π
- **–û–≤–µ—Ä–∫–≤–æ—Ç—ã** - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –µ—Å–ª–∏ remaining ‚â§ 0

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 8.2+
- Laravel 12
- MySQL 8+
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

## üìö –ü–æ–ª–Ω—ã–π –∫–æ–¥

–í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–¥—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –°–∫–æ–ø–∏—Ä—É–π —Ñ–∞–π–ª—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞–ø–∫–∏ —Ç–≤–æ–µ–≥–æ Laravel –ø—Ä–æ–µ–∫—Ç–∞.

## üîó –°—Å—ã–ª–∫–∏

- GitHub: https://github.com/SystemBalance/slot-booking-api
- Laravel: https://laravel.com
- Documentation: –°–º–æ—Ç—Ä–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
